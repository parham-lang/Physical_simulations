<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شبیه‌ساز فیزیکی حرکت بر سطح شیب‌دار</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f2f5;
        }
        canvas {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: auto;
        }
        .control-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-7xl mx-auto">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-blue-800">شبیه‌ساز حرکت بر سطح شیب‌دار</h1>
            <p class="text-gray-600 mt-2">مبدا مختصات: رأس قائمه | تحلیل مولفه‌های افقی و عمودی</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Simulation View -->
            <div class="lg:col-span-3 space-y-4">
                <canvas id="simCanvas" width="900" height="450"></canvas>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white p-3 rounded-lg shadow border-t-4 border-blue-500">
                        <h3 class="font-bold text-xs text-gray-500 mb-2">مکان افقی (x) بر حسب متر</h3>
                        <canvas id="xGraph" width="300" height="120"></canvas>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow border-t-4 border-purple-500">
                        <h3 class="font-bold text-xs text-gray-500 mb-2">مکان عمودی (y) بر حسب متر</h3>
                        <canvas id="yGraph" width="300" height="120"></canvas>
                    </div>
                    <div class="bg-white p-3 rounded-lg shadow border-t-4 border-green-500">
                        <h3 class="font-bold text-xs text-gray-500 mb-2">سرعت لحظه‌ای (v) بر حسب m/s</h3>
                        <canvas id="velGraph" width="300" height="120"></canvas>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="lg:col-span-1 control-panel p-5 rounded-xl shadow-lg border border-gray-200 h-fit">
                <h2 class="text-lg font-bold mb-4 border-b pb-2 text-gray-800">تنظیمات آزمایش</h2>
                
                <div class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">زاویه سطح شیب‌دار: <span id="angleVal" class="font-bold text-blue-600">30</span> درجه</label>
                        <input type="range" id="angleInput" min="10" max="70" value="30" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                        <p class="text-[10px] text-gray-500 mt-1 leading-tight">نکته: طول مسیر حرکت ثابت است.</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">ضریب اصطکاک (μ): <span id="frictionVal" class="font-bold text-blue-600">0.10</span></label>
                        <input type="range" id="frictionInput" min="0" max="0.8" step="0.01" value="0.10" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700">جرم جسم (m): <span id="massVal" class="font-bold text-blue-600">5</span> کیلوگرم</label>
                        <input type="range" id="massInput" min="1" max="20" value="5" class="w-full h-2 bg-blue-200 rounded-lg appearance-none cursor-pointer">
                        <p class="text-[10px] text-gray-500 mt-1 leading-tight">نکته: در غیاب مقاومت هوا، جرم بر شتاب حرکت بی‌تأثیر است.</p>
                    </div>

                    <div class="flex flex-col gap-2 pt-2">
                        <button id="startBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition shadow-md">شروع / توقف</button>
                        <button id="resetBtn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition shadow-md">بازنشانی</button>
                    </div>

                    <div class="mt-4 p-4 bg-gray-50 rounded-lg text-sm space-y-3 border border-gray-200 shadow-inner">
                        <p class="font-bold border-b pb-1 text-gray-700">وضعیت لحظه‌ای:</p>
                        <div class="flex justify-between">
                            <span>مکان افقی (x):</span>
                            <span class="font-mono text-blue-700"><span id="posXText">0.0</span> متر</span>
                        </div>
                        <div class="flex justify-between">
                            <span>مکان عمودی (y):</span>
                            <span class="font-mono text-purple-700"><span id="posYText">0.0</span> متر</span>
                        </div>
                        <div class="flex justify-between">
                            <span>سرعت (v):</span>
                            <span class="font-mono text-green-700"><span id="velText">0.00</span> m/s</span>
                        </div>
                        <div class="flex justify-between">
                            <span>شتاب (a):</span>
                            <span class="font-mono text-red-600"><span id="accText">0.00</span> m/s²</span>
                        </div>
                        <div class="flex justify-between border-t pt-1">
                            <span>زمان سپری شده (t):</span>
                            <span class="font-mono text-orange-600 font-bold"><span id="timeText">0.00</span> ثانیه</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        
        const xCtx = document.getElementById('xGraph').getContext('2d');
        const yCtx = document.getElementById('yGraph').getContext('2d');
        const vCtx = document.getElementById('velGraph').getContext('2d');

        const angleInput = document.getElementById('angleInput');
        const frictionInput = document.getElementById('frictionInput');
        const massInput = document.getElementById('massInput');
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');

        const g = 9.8;
        let angle = parseInt(angleInput.value) * Math.PI / 180;
        let mu = parseFloat(frictionInput.value);
        let mass = parseFloat(massInput.value);
        
        let s = 0; 
        let velocity = 0;
        let acceleration = 0;
        let time = 0;
        let isRunning = false;
        let history = [];

        const groundY = 380;
        const startX = 150; 
        const slopeLength = 600;
        const blockSize = 40;

        function updatePhysics() {
            if (!isRunning) return;

            const dt = 1/60;
            const sinT = Math.sin(angle);
            const cosT = Math.cos(angle);
            
            const Fg_parallel = mass * g * sinT;
            const F_friction_max = mu * mass * g * cosT;
            
            let netForce = Fg_parallel - F_friction_max;
            if (Fg_parallel <= F_friction_max && velocity <= 0.001) {
                netForce = 0;
                velocity = 0;
            }

            acceleration = netForce / mass;
            velocity += acceleration * dt;
            s += velocity * (dt * 50); 

            if (s >= slopeLength - blockSize) {
                s = slopeLength - blockSize;
                isRunning = false; 
            }

            time += dt;

            const currentX = s * cosT / 50; 
            const currentY = (slopeLength - blockSize - s) * sinT / 50;

            history.push({t: time, x: currentX, y: currentY, v: velocity});
            if (history.length > 500) history.shift();

            document.getElementById('accText').innerText = acceleration.toFixed(2);
            document.getElementById('velText').innerText = velocity.toFixed(2);
            document.getElementById('posXText').innerText = currentX.toFixed(1);
            document.getElementById('posYText').innerText = currentY.toFixed(1);
            document.getElementById('timeText').innerText = time.toFixed(2);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const startY = groundY - (slopeLength * Math.sin(angle));
            const endX = startX + (slopeLength * Math.cos(angle));

            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#94a3b8';
            ctx.beginPath();
            ctx.moveTo(startX, groundY - 100); ctx.lineTo(startX, groundY + 50); 
            ctx.moveTo(startX - 50, groundY); ctx.lineTo(startX + 100, groundY); 
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.fillStyle = '#64748b';
            ctx.font = '12px Vazirmatn';
            ctx.fillText("(0,0) مبدا مختصات", startX - 80, groundY + 20);

            ctx.beginPath();
            ctx.moveTo(0, groundY);
            ctx.lineTo(canvas.width, groundY);
            ctx.strokeStyle = '#cbd5e1';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(startX, groundY);
            ctx.lineTo(endX, groundY);
            ctx.lineTo(startX, startY);
            ctx.closePath();
            ctx.fillStyle = '#f8fafc';
            ctx.fill();
            ctx.strokeStyle = '#1e293b';
            ctx.lineWidth = 3;
            ctx.stroke();

            const blockX = startX + s * Math.cos(angle);
            const blockY = startY + s * Math.sin(angle);

            ctx.save();
            ctx.translate(blockX, blockY);
            ctx.rotate(angle);
            
            ctx.fillStyle = '#3b82f6';
            ctx.fillRect(0, -blockSize, blockSize, blockSize);
            ctx.strokeStyle = '#1d4ed8';
            ctx.lineWidth = 2;
            ctx.strokeRect(0, -blockSize, blockSize, blockSize);

            const vScale = 6;
            ctx.rotate(-angle); 
            drawVector(ctx, blockSize/2, -blockSize/2, 0, mass * g * (vScale/mass*5), '#ef4444', 'نیروی وزن (W)');
            ctx.rotate(angle);
            drawVector(ctx, blockSize/2, -blockSize/2, 0, -mass * g * Math.cos(angle) * (vScale/mass*5), '#10b981', 'نیروی عمودی (FN)');
            if (mu > 0) drawVector(ctx, 0, -blockSize/2, -mu * mass * g * Math.cos(angle) * (vScale/mass*5), 0, '#f59e0b', 'اصطکاک (f)');
            
            ctx.restore();
            drawGraphs();
        }

        function drawVector(ctx, x, y, vx, vy, color, label) {
            if (Math.abs(vx) < 1 && Math.abs(vy) < 1) return;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + vx, y + vy);
            ctx.strokeStyle = color;
            ctx.stroke();
            const head = 6;
            const a = Math.atan2(vy, vx);
            ctx.beginPath();
            ctx.moveTo(x + vx, y + vy);
            ctx.lineTo(x + vx - head * Math.cos(a - Math.PI / 6), y + vy - head * Math.sin(a - Math.PI / 6));
            ctx.lineTo(x + vx - head * Math.cos(a + Math.PI / 6), y + vy - head * Math.sin(a + Math.PI / 6));
            ctx.fillStyle = color;
            ctx.fill();
            ctx.font = '10px Vazirmatn';
            ctx.fillText(label, x + vx + 2, y + vy - 2);
        }

        function drawGraphs() {
            const render = (gCtx, key, color, maxVal) => {
                gCtx.clearRect(0, 0, 300, 120);
                if (history.length < 2) return;
                gCtx.beginPath();
                gCtx.strokeStyle = color;
                gCtx.lineWidth = 2;
                const step = 300 / 500;
                history.forEach((p, i) => {
                    const x = i * step;
                    const y = 110 - (p[key] / maxVal) * 90;
                    if (i === 0) gCtx.moveTo(x, y);
                    else gCtx.lineTo(x, y);
                });
                gCtx.stroke();
            };
            
            const maxPos = (slopeLength * Math.max(Math.sin(angle), Math.cos(angle))) / 50;
            render(xCtx, 'x', '#3b82f6', maxPos);
            render(yCtx, 'y', '#8b5cf6', maxPos);
            render(vCtx, 'v', '#10b981', 12);
        }

        function animate() {
            updatePhysics();
            draw();
            requestAnimationFrame(animate);
        }

        angleInput.addEventListener('input', (e) => {
            angle = e.target.value * Math.PI / 180;
            document.getElementById('angleVal').innerText = e.target.value;
            resetSim();
        });

        frictionInput.addEventListener('input', (e) => {
            mu = parseFloat(e.target.value);
            document.getElementById('frictionVal').innerText = mu.toFixed(2);
        });

        massInput.addEventListener('input', (e) => {
            mass = parseFloat(e.target.value);
            document.getElementById('massVal').innerText = mass;
            if (!isRunning) draw(); 
        });

        startBtn.addEventListener('click', () => {
            if (s >= slopeLength - blockSize - 1) resetSim();
            isRunning = !isRunning;
        });

        resetBtn.addEventListener('click', resetSim);

        function resetSim() {
            s = 0; velocity = 0; time = 0; history = []; isRunning = false;
            document.getElementById('timeText').innerText = "0.00";
            draw();
        }

        window.onload = animate;
    </script>
</body>
</html>